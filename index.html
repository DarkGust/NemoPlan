<!DOCTYPE html>
<html lang="da">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Dykker Grupper</title>
<style>
  :root{
    --bg:#0f1115; --card:#171a21; --muted:#232838; --text:#e8ecf1; --sub:#a9b3c7; --ok:#1fa37c; --warn:#e94b4b;
    --chip:#1e2433; --chip-trainer:#20311f; --chip-diver:#1f2433;
  }
  html,body{height:100%; margin:0; background:var(--bg); color:var(--text); font-family:system-ui, -apple-system, sans-serif;}
  *{box-sizing:border-box}
  .app{ display:grid; grid-template-columns:1fr 2fr; gap:6px; padding:6px; height:100vh; width:100vw;}
  .panel, .group{background:var(--card); border-radius:12px; padding:6px; box-shadow:0 2px 10px rgba(0,0,0,.25);}
  .title{font-weight:700; font-size:14px; color:var(--sub); margin-bottom:6px;}
  .search{width:100%; padding:6px; border-radius:10px; border:1px solid var(--muted); background:#0e121a; color:var(--text); margin-bottom:6px;}
  .chips{ display:flex; flex-direction:column; gap:4px; max-height:calc(100vh - 120px); overflow:auto; }
  .chip{padding:6px 8px; border-radius:999px; background:var(--chip); border:1px solid #2a3147; cursor:grab; display:flex; justify-content:space-between; font-size:12px;}
  .chip[data-trainer="true"]{ background: var(--chip-trainer); border-color:#2b4a2e;}
  .groups{ display:grid; grid-template-columns:1fr 1fr; gap:6px; overflow:auto; max-height:100%;}
  .group{display:grid; grid-template-rows:auto auto 1fr; gap:4px; border:2px solid transparent;}
  .group.warn{border-color: var(--warn);}
  .group.ok{border-color: var(--ok);}
  .pairs{display:grid; gap:4px;}
  .pair{background:var(--muted); border:1px dashed #3a4160; min-height:34px; display:flex; flex-wrap:wrap; gap:4px; padding:4px;}
  .btn{background:#0e121a; border:1px solid var(--muted); color:var(--text); padding:4px 6px; border-radius:10px; font-size:12px; cursor:pointer;}
  select{background:#0e121a; color:var(--text); border:1px solid var(--muted); border-radius:8px; padding:4px; font-size:12px;}
  .reset-btn{margin-top:6px; width:100%; padding:6px; font-size:12px; background:#331111; border:1px solid #662222; border-radius:10px; color:#f88; font-weight:700; cursor:pointer;}
</style>
</head>
<body>
<div class="app">
  <section class="panel">
    <div class="title">Dykkerliste</div>
    <input id="search" class="search" placeholder="Søg…">
    <div id="roster" class="chips"></div>
    <button id="resetBtn" class="reset-btn">Reset alle grupper</button>
  </section>
  <section class="groups" id="groupsContainer"></section>
</div>
<template id="chip-template">
  <div class="chip">
    <span class="name"></span>
    <span class="tag"></span>
  </div>
</template>
<script>
const PEOPLE=[
  {name:"Bjørk", level:"*", trainer:false}, {name:"Ditte", level:"**", trainer:false}, {name:"Gustav", level:"**", trainer:false},
  {name:"Ida", level:"*", trainer:false}, {name:"Ingeborg", level:"**", trainer:false}, {name:"Jacob", level:"***", trainer:false},
  {name:"Lucas", level:"***", trainer:false}, {name:"Mathias", level:"***", trainer:false}, {name:"Nicolaj", level:"*", trainer:false},
  {name:"Sean", level:"*", trainer:false}, {name:"Simone", level:"*", trainer:false}, {name:"Thor", level:"*", trainer:false},
  {name:"Tilde", level:"*", trainer:false}, {name:"Anton", level:"(T)", trainer:true}, {name:"Frederikke", level:"(T)", trainer:true},
  {name:"Katrine", level:"(T)", trainer:true}, {name:"Nicki", level:"(T)", trainer:true}, {name:"Per", level:"(T)", trainer:true}
];

const RANK=lvl=>lvl==='*'?1:lvl==='**'?2:lvl==='***'?3:9;
PEOPLE.sort((a,b)=>RANK(a.level)-RANK(b.level)||a.name.localeCompare(b.name,'da'));

const rosterEl=document.getElementById('roster');
const tmpl=document.getElementById('chip-template');
const groupsContainer=document.getElementById('groupsContainer');

function makeChip(p){
  const n=tmpl.content.firstElementChild.cloneNode(true);
  n.querySelector('.name').textContent=p.name;
  n.querySelector('.tag').textContent=p.level;
  n.dataset.name=p.name;
  n.dataset.level=p.level;
  n.dataset.trainer=String(!!p.trainer);
  return n;
}

function renderRoster(filter=''){ rosterEl.innerHTML=''; PEOPLE.forEach(p=>{ if(filter&&!(p.name+' '+p.level).toLowerCase().includes(filter))return; rosterEl.appendChild(makeChip(p)); }); }
renderRoster();

document.getElementById('search').addEventListener('input', e=>renderRoster(e.target.value.trim().toLowerCase()));

function pad2(n){return (n<10?'0':'')+n}
function fillSelects(sel){ sel.querySelectorAll('select.h').forEach(s=>{s.innerHTML='';for(let h=0;h<24;h++){ const o=document.createElement('option'); o.value=o.textContent=pad2(h); s.appendChild(o);}});
sel.querySelectorAll('select.m').forEach(s=>{s.innerHTML='';for(let m=0;m<60;m++){ const o=document.createElement('option'); o.value=o.textContent=pad2(m); s.appendChild(o);}});}

function createGroups(){
  for(let i=1;i<=4;i++){
    const g=document.createElement('div'); g.className='group'; g.dataset.group=i;
    g.innerHTML=`<div class="title">Gruppe ${i}</div>
      <div class="time">
        <label>Start:</label><select class="h start-h"></select><select class="m start-m"></select>
        <button class="btn now-start">Nu!</button>
        <label>Slut:</label><select class="h end-h"></select><select class="m end-m"></select>
        <button class="btn now-end">Nu!</button>
      </div>
      <div class="pairs">
        <div class="pair" data-pair></div>
        <div class="pair" data-pair></div>
        <div class="pair" data-pair></div>
      </div>`;
    groupsContainer.appendChild(g);
    fillSelects(g);
    g.querySelector('.now-start').addEventListener('click',()=>{ const d=new Date(); g.querySelector('.start-h').value=pad2(d.getHours()); g.querySelector('.start-m').value=pad2(d.getMinutes()); saveState(); });
    g.querySelector('.now-end').addEventListener('click',()=>{ const d=new Date(); g.querySelector('.end-h').value=pad2(d.getHours()); g.querySelector('.end-m').value=pad2(d.getMinutes()); saveState(); });
  }
}
createGroups();

function groupHasTrainer(groupEl){ return !!groupEl.querySelector('.chip[data-trainer="true"]'); }
function updateGroupRings(){ document.querySelectorAll('.group').forEach(g=>{ g.classList.toggle('ok',groupHasTrainer(g)); g.classList.toggle('warn',!groupHasTrainer(g)); }); }

function saveState(){ const data={groups:[]}; document.querySelectorAll('.group').forEach(g=>{ const gd={startH:g.querySelector('.start-h').value,endH:g.querySelector('.end-h').value,startM:g.querySelector('.start-m').value,endM:g.querySelector('.end-m').value,pairs:[]}; g.querySelectorAll('.pair').forEach(p=>{ gd.pairs.push([...p.querySelectorAll('.chip')].map(c=>({name:c.dataset.name,level:c.dataset.level,trainer:c.dataset.trainer}))); }); data.groups.push(gd); }); localStorage.setItem('dykkerApp',JSON.stringify(data)); }

function loadState(){ try{ const data=JSON.parse(localStorage.getItem('dykkerApp')||'{}'); if(!data.groups) return; const gs=document.querySelectorAll('.group'); gs.forEach((g,gi)=>{ const gd=data.groups[gi]; if(!gd)return; g.querySelector('.start-h').value=gd.startH; g.querySelector('.start-m').value=gd.startM; g.querySelector('.end-h').value=gd.endH; g.querySelector('.end-m').value=gd.endM; g.querySelectorAll('.pair').forEach((p,pi)=>{ p.innerHTML=''; if(!gd.pairs[pi]) return; gd.pairs[pi].forEach(cdata=>{ p.appendChild(makeChip({name:cdata.name,level:cdata.level,trainer:cdata.trainer==='true'})); }); }); }); updateGroupRings(); }catch(e){ console.error('Fejl i loadState',e); localStorage.removeItem('dykkerApp'); renderRoster(); }}
loadState();

document.getElementById('resetBtn').addEventListener('click',()=>{
  if(confirm('Er du sikker på, du vil nulstille alle grupper?')){
    document.querySelectorAll('.group').forEach(g=>{ g.querySelectorAll('.pair').forEach(p=>p.innerHTML=''); g.querySelector('.start-h').value='00'; g.querySelector('.start-m').value='00'; g.querySelector('.end-h').value='00'; g.querySelector('.end-m').value='00'; });
    updateGroupRings();
    localStorage.removeItem('dykkerApp');
  }
});

// Simpelt drag & drop
let drag=null;
document.addEventListener('pointerdown',e=>{ const c=e.target.closest('.chip'); if(!c) return; drag={el:c,from:c.parentElement,dx:e.clientX,dy:e.clientY}; c.style.opacity='0.5'; });
document.addEventListener('pointerup',e=>{ if(!drag) return; const drop=document.elementFromPoint(e.clientX,e.clientY).closest('.pair')||document.getElementById('roster'); if(drop){ drag.el.remove(); drop.appendChild(drag.el); updateGroupRings(); saveState(); } drag.el.style.opacity='1'; drag=null; });
</script>
</body>
</html>